[2024-06-24T04:14:54.688+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: snowflake_connector3.count_query manual__2024-06-24T04:14:09.322012+00:00 [queued]>
[2024-06-24T04:14:54.700+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: snowflake_connector3.count_query manual__2024-06-24T04:14:09.322012+00:00 [queued]>
[2024-06-24T04:14:54.701+0000] {taskinstance.py:1361} INFO - Starting attempt 2 of 2
[2024-06-24T04:14:54.718+0000] {taskinstance.py:1382} INFO - Executing <Task(PythonOperator): count_query> on 2024-06-24 04:14:09.322012+00:00
[2024-06-24T04:14:54.727+0000] {standard_task_runner.py:57} INFO - Started process 1976 to run task
[2024-06-24T04:14:54.731+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'snowflake_connector3', 'count_query', 'manual__2024-06-24T04:14:09.322012+00:00', '--job-id', '27', '--raw', '--subdir', 'DAGS_FOLDER/staging/rbroker/dag.py', '--cfg-path', '/tmp/tmpq2b9se81']
[2024-06-24T04:14:54.736+0000] {standard_task_runner.py:85} INFO - Job 27: Subtask count_query
[2024-06-24T04:14:54.798+0000] {task_command.py:416} INFO - Running <TaskInstance: snowflake_connector3.count_query manual__2024-06-24T04:14:09.322012+00:00 [running]> on host b00a3d1afa8e
[2024-06-24T04:14:54.894+0000] {taskinstance.py:1662} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='Airflow' AIRFLOW_CTX_DAG_ID='snowflake_connector3' AIRFLOW_CTX_TASK_ID='count_query' AIRFLOW_CTX_EXECUTION_DATE='2024-06-24T04:14:09.322012+00:00' AIRFLOW_CTX_TRY_NUMBER='2' AIRFLOW_CTX_DAG_RUN_ID='manual__2024-06-24T04:14:09.322012+00:00'
[2024-06-24T04:14:54.910+0000] {base.py:73} INFO - Using connection ID 'my_snowflake_conn' for task execution.
[2024-06-24T04:14:54.911+0000] {connection.py:334} INFO - Snowflake Connector for Python Version: 3.3.1, Python Version: 3.8.18, Platform: Linux-6.3.13-linuxkit-x86_64-with-glibc2.2.5
[2024-06-24T04:14:54.913+0000] {connection.py:1103} INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2024-06-24T04:14:54.913+0000] {connection.py:1121} INFO - Setting use_openssl_only mode to False
[2024-06-24T04:14:55.397+0000] {connection.py:547} WARNING - Certificate did not match expected hostname: ct36992.ca-central-1.snowflakecomputing.com. Certificate: {'subject': ((('commonName', '*.prod3.us-west-2.snowflakecomputing.com'),),), 'subjectAltName': [('DNS', '*.prod3.us-west-2.snowflakecomputing.com'), ('DNS', '*.us-west-2.snowflakecomputing.com'), ('DNS', '*.global.snowflakecomputing.com'), ('DNS', '*.snowflakecomputing.com'), ('DNS', '*.prod3.us-west-2.aws.snowflakecomputing.com')]}
[2024-06-24T04:14:55.399+0000] {connectionpool.py:812} WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(CertificateError("hostname 'ct36992.ca-central-1.snowflakecomputing.com' doesn't match either of '*.prod3.us-west-2.snowflakecomputing.com', '*.us-west-2.snowflakecomputing.com', '*.global.snowflakecomputing.com', '*.snowflakecomputing.com', '*.prod3.us-west-2.aws.snowflakecomputing.com'"))': /session/v1/login-request?request_id=9530e079-6059-431a-956a-a4b05d9e7890&databaseName=WDP_DEV&schemaName=staging&warehouse=COMPUTE_WH&roleName=ACCOUNTADMIN&request_guid=4b1faaf8-019b-4afc-8e89-542aa52a2a81
[2024-06-24T04:14:55.663+0000] {connection.py:547} WARNING - Certificate did not match expected hostname: ct36992.ca-central-1.snowflakecomputing.com. Certificate: {'subject': ((('commonName', '*.prod3.us-west-2.snowflakecomputing.com'),),), 'subjectAltName': [('DNS', '*.prod3.us-west-2.snowflakecomputing.com'), ('DNS', '*.us-west-2.snowflakecomputing.com'), ('DNS', '*.global.snowflakecomputing.com'), ('DNS', '*.snowflakecomputing.com'), ('DNS', '*.prod3.us-west-2.aws.snowflakecomputing.com')]}
[2024-06-24T04:14:55.669+0000] {network.py:1037} ERROR - Failed to get the response. Hanging? method: post, url: https://ct36992.ca-central-1.snowflakecomputing.com:443/session/v1/login-request?request_id=9530e079-6059-431a-956a-a4b05d9e7890&databaseName=WDP_DEV&schemaName=staging&warehouse=COMPUTE_WH&roleName=ACCOUNTADMIN&request_guid=4b1faaf8-019b-4afc-8e89-542aa52a2a81, headers:{'Content-Type': 'application/json', 'accept': 'application/snowflake', 'User-Agent': 'PythonConnector/3.3.1 (Linux-6.3.13-linuxkit-x86_64-with-glibc2.2.5) CPython/3.8.18', 'Content-Encoding': 'gzip'}, data: {"data": {"CLIENT_APP_ID": "PythonConnector", "CLIENT_APP_VERSION": "3.3.1", "SVN_REVISION": null, "ACCOUNT_NAME": "ct36992", "LOGIN_NAME": "mmahmoud", "CLIENT_ENVIRONMENT": {"APPLICATION": "AIRFLOW", "OS": "Linux", "OS_VERSION": "Linux-6.3.13-linuxkit-x86_64-with-glibc2.2.5", "PYTHON_VERSION": "3.8.18", "PYTHON_RUNTIME": "CPython", "PYTHON_COMPILER": "GCC 10.2.1 20210110", "OCSP_MODE": "FAIL_OPEN", "TRACING": 20, "LOGIN_TIMEOUT": 120, "NETWORK_TIMEOUT": null}, "PASSWORD": "**** "SESSION_PARAMETERS": {"CLIENT_PREFETCH_THREADS": 4}}}
[2024-06-24T04:14:57.955+0000] {connection.py:547} WARNING - Certificate did not match expected hostname: ct36992.ca-central-1.snowflakecomputing.com. Certificate: {'subject': ((('commonName', '*.prod3.us-west-2.snowflakecomputing.com'),),), 'subjectAltName': [('DNS', '*.prod3.us-west-2.snowflakecomputing.com'), ('DNS', '*.us-west-2.snowflakecomputing.com'), ('DNS', '*.global.snowflakecomputing.com'), ('DNS', '*.snowflakecomputing.com'), ('DNS', '*.prod3.us-west-2.aws.snowflakecomputing.com')]}
[2024-06-24T04:14:57.957+0000] {connectionpool.py:812} WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(CertificateError("hostname 'ct36992.ca-central-1.snowflakecomputing.com' doesn't match either of '*.prod3.us-west-2.snowflakecomputing.com', '*.us-west-2.snowflakecomputing.com', '*.global.snowflakecomputing.com', '*.snowflakecomputing.com', '*.prod3.us-west-2.aws.snowflakecomputing.com'"))': /session/v1/login-request?request_id=43aef3e0-36ec-4444-8015-27d8b1b5afe9&databaseName=WDP_DEV&schemaName=staging&warehouse=COMPUTE_WH&roleName=ACCOUNTADMIN&request_guid=678240e1-27c8-424c-87b8-350cb8680076
[2024-06-24T04:14:58.213+0000] {connection.py:547} WARNING - Certificate did not match expected hostname: ct36992.ca-central-1.snowflakecomputing.com. Certificate: {'subject': ((('commonName', '*.prod3.us-west-2.snowflakecomputing.com'),),), 'subjectAltName': [('DNS', '*.prod3.us-west-2.snowflakecomputing.com'), ('DNS', '*.us-west-2.snowflakecomputing.com'), ('DNS', '*.global.snowflakecomputing.com'), ('DNS', '*.snowflakecomputing.com'), ('DNS', '*.prod3.us-west-2.aws.snowflakecomputing.com')]}
[2024-06-24T04:14:58.217+0000] {network.py:1037} ERROR - Failed to get the response. Hanging? method: post, url: https://ct36992.ca-central-1.snowflakecomputing.com:443/session/v1/login-request?request_id=43aef3e0-36ec-4444-8015-27d8b1b5afe9&databaseName=WDP_DEV&schemaName=staging&warehouse=COMPUTE_WH&roleName=ACCOUNTADMIN&request_guid=678240e1-27c8-424c-87b8-350cb8680076, headers:{'Content-Type': 'application/json', 'accept': 'application/snowflake', 'User-Agent': 'PythonConnector/3.3.1 (Linux-6.3.13-linuxkit-x86_64-with-glibc2.2.5) CPython/3.8.18', 'Content-Encoding': 'gzip'}, data: {"data": {"CLIENT_APP_ID": "PythonConnector", "CLIENT_APP_VERSION": "3.3.1", "SVN_REVISION": null, "ACCOUNT_NAME": "ct36992", "LOGIN_NAME": "mmahmoud", "CLIENT_ENVIRONMENT": {"APPLICATION": "AIRFLOW", "OS": "Linux", "OS_VERSION": "Linux-6.3.13-linuxkit-x86_64-with-glibc2.2.5", "PYTHON_VERSION": "3.8.18", "PYTHON_RUNTIME": "CPython", "PYTHON_COMPILER": "GCC 10.2.1 20210110", "OCSP_MODE": "FAIL_OPEN", "TRACING": 20, "LOGIN_TIMEOUT": 120, "NETWORK_TIMEOUT": null}, "PASSWORD": "**** "SESSION_PARAMETERS": {"CLIENT_PREFETCH_THREADS": 4}}}
[2024-06-24T04:14:58.221+0000] {taskinstance.py:1937} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/connection.py", line 1246, in _authenticate
    auth.authenticate(
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/auth/_auth.py", line 250, in authenticate
    ret = self._rest._post_request(
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/network.py", line 730, in _post_request
    ret = self.fetch(
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/network.py", line 849, in fetch
    ret = self._request_exec_wrapper(
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/network.py", line 987, in _request_exec_wrapper
    raise e
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/network.py", line 902, in _request_exec_wrapper
    self._handle_unknown_error(method, full_url, headers, data, conn)
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/network.py", line 1042, in _handle_unknown_error
    Error.errorhandler_wrapper(
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 290, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 348, in hand_to_other_handler
    connection.errorhandler(connection, cursor, error_class, error_value)
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/errors.py", line 221, in default_errorhandler
    raise error_class(
snowflake.connector.errors.OperationalError: 250003: 250003: Failed to get the response. Hanging? method: post, url: https://ct36992.ca-central-1.snowflakecomputing.com:443/session/v1/login-request?request_id=9530e079-6059-431a-956a-a4b05d9e7890&databaseName=WDP_DEV&schemaName=staging&warehouse=COMPUTE_WH&roleName=ACCOUNTADMIN&request_guid=4b1faaf8-019b-4afc-8e89-542aa52a2a81

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/staging/rbroker/dag.py", line 26, in count1
    result = dwh_hook.get_first("select count(*) from abcd_db.public.test3")
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/common/sql/hooks/sql.py", line 264, in get_first
    return self.run(sql=sql, parameters=parameters, handler=fetch_one_handler)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/snowflake/hooks/snowflake.py", line 382, in run
    with closing(self.get_conn()) as conn:
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/snowflake/hooks/snowflake.py", line 276, in get_conn
    conn = connector.connect(**conn_config)
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/__init__.py", line 54, in Connect
    return SnowflakeConnection(**kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/connection.py", line 382, in __init__
    self.connect(**kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/connection.py", line 662, in connect
    self.__open_connection()
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/connection.py", line 935, in __open_connection
    self.authenticate_with_retry(self.auth_class)
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/connection.py", line 1220, in authenticate_with_retry
    self._authenticate(auth_instance)
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/connection.py", line 1291, in _authenticate
    raise auth_op from e
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/connection.py", line 1268, in _authenticate
    auth_instance.handle_timeout(
  File "/home/airflow/.local/lib/python3.8/site-packages/snowflake/connector/auth/by_plugin.py", line 219, in handle_timeout
    raise error
snowflake.connector.errors.OperationalError: 250001: 250001: Could not connect to Snowflake backend after 1 attempt(s).Aborting
[2024-06-24T04:14:58.233+0000] {taskinstance.py:1400} INFO - Marking task as FAILED. dag_id=snowflake_connector3, task_id=count_query, execution_date=20240624T041409, start_date=20240624T041454, end_date=20240624T041458
[2024-06-24T04:14:58.251+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 27 for task count_query (250001: 250001: Could not connect to Snowflake backend after 1 attempt(s).Aborting; 1976)
[2024-06-24T04:14:58.295+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2024-06-24T04:14:58.316+0000] {taskinstance.py:2778} INFO - 0 downstream tasks scheduled from follow-on schedule check
